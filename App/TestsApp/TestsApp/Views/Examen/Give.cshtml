@model TestsApp.Models.Examen

@{
    ViewBag.Title = "Give";
}

@Scripts.Render("~/bundles/countdown")

<div class="box-header">
    <i class="icon-th-list"></i>Dar Examen 
</div>
@using (Html.BeginForm())
{
    <input type="hidden" id="hdn-Minutos" value="@Model.TiempoMaximo.Minutes" />
    <input type="hidden" id="hdn-Segundos" value="@Model.TiempoMaximo.Seconds" />
    <input type="hidden" id="hdn-FechaInicioEjecucion" value="@Model.FechaEjecucion.ToString("yyyy,MM,dd,H,mm,ss")" />
    @Html.HiddenFor(m => m.TiempoTranscurrido, new { id = "hdn-TiempoTranscurrido" });
    <div class="row-fluid">
        <div class="padded">
            <div class="row-fluid">
                <div class="span6">
                    <div class="input full-width">
                        <h1>
                            @Model.Titulo
                        </h1>
                    </div>
                    <div class="input full-width">
                        <h4>Línea: @Model.Linea.Nombre
                        </h4>
                    </div>
                </div>
                <div class="span6">

                    <div class="row-fluid input full-width">
                        Tiempo Máximo: @Model.TiempoMaximo

                    </div>
                    <div class="row-fluid input full-width">
                        <div class="span2">
                            Tiempo Restante:
                        </div>
                        <div class="span4">
                            <div id="tiempoRestante">
                            </div>
                        </div>

                    </div>

                </div>
            </div>
            <div class="section-title"></div>
            <div class="row-fluid">
                <div class="box-header">
                    <i class="icon-check"></i>Preguntas
                </div>
                <div id="PreguntasContainer">
                    @Html.EditorFor(m=>m.Pregunta)
                </div>
            </div>
            <div class="row-fluid">
                <button type="button" class="btn btn-small">Cancelar</button>
                <input type="submit" value="Terminar" class="btn btn-small medium-blue btn-terminar-examen" />
            </div>
        </div>
    </div>
}
<script type="text/javascript">
    $(function () {
        var austDay = new Date();
        austDay = new Date(2013, 03, 05);
        var minutos = parseInt($('#hdn-Minutos').val());
        var segundos = parseInt($('#hdn-Segundos').val());
        var untilStr = "+" + minutos + "m " + "+" + segundos + "s";
        var strDate = $('#hdn-FechaInicioEjecucion').val().split(',');
        var d = new Date(parseInt(strDate[0]), parseInt(strDate[1]) - 1, parseInt(strDate[2]), parseInt(strDate[3]), parseInt(strDate[4]), parseInt(strDate[5]), 0);
        var dInicio = new Date(parseInt(strDate[0]), parseInt(strDate[1]) - 1, parseInt(strDate[2]), parseInt(strDate[3]), parseInt(strDate[4]), parseInt(strDate[5]), 0);
        //d = new Date();
        d.setSeconds(d.getSeconds() + segundos);
        d.setMinutes(d.getMinutes() + minutos);
        $('#tiempoRestante').countdown({ until: d, format: 'MS', onExpiry: liftOff });

        function liftOff() {
            setTiempoTranscurrido();
            $('.btn-terminar-examen').click();
        }

        $('.btn-terminar-examen').click(function () {
            setTiempoTranscurrido();
        });

        function setTiempoTranscurrido() {
            var dActual = new Date();
            var diff = dActual - dInicio;
            var xHelper = diff / 1000;
            var numhours = Math.floor(((xHelper % 31536000) % 86400) / 3600);
            var numminutes = Math.floor((((xHelper % 31536000) % 86400) % 3600) / 60);
            var numseconds = Math.floor((((xHelper % 31536000) % 86400) % 3600) % 60);
            var strTime = numhours.toString() + ':' + numminutes.toString() + ':' + numseconds.toString();
            $("#hdn-TiempoTranscurrido").val(strTime);
        }
    });

    


</script>
